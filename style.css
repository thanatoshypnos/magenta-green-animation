:root{
  /* Core colors */
  --magenta: #ff00ff;
  --green:   #00ff00;

  /* Durations */
  --hold: 30s;        /* dot holds */
  --grow: 12s;        /* dot grows to fill */
  --settle: 2s;       /* brief calm after fill */
  --full: calc((var(--hold) + var(--grow) + var(--settle)) * 2); /* whole cycle */

  /* Text timings */
  --text-on: 3.2s;    /* visible time per fragment */
  --text-gap: 1.2s;   /* blank magenta time between fragments */
  --text-blur: 12px;  /* soft fade */
}

html, body {
  height: 100%;
  margin: 0;
  background: var(--magenta); /* start: full magenta */
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, sans-serif;
}

/* ===== Stage: NO animation at rest ===== */
.stage {
  position: fixed;
  inset: 0;
  overflow: hidden;
  background: var(--magenta);
  will-change: background-color;
}

/* Helper div for the handoff pop of green */
.handoff {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background-repeat: no-repeat;
  background-position: 50% 50%;
  background-image: radial-gradient(circle, var(--green) 60%, rgba(0,0,0,0) 61%);
  filter: blur(10px);
  opacity: 0; /* off by default */
}

/* Radial layers for main dots (pseudo-elements) — at rest, invisible */
.stage::before,
.stage::after {
  content:"";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background-repeat: no-repeat;
  background-position: 50% 50%;
  filter: blur(10px);  /* soft edge */
  opacity: 0;          /* hidden until run */
  transition: opacity .2s linear;
}

/* Gradient definitions */
.stage::before{ background-image: radial-gradient(circle, var(--green)   60%, rgba(0,0,0,0) 61%); }
.stage::after { background-image: radial-gradient(circle, var(--magenta) 60%, rgba(0,0,0,0) 61%); }

/* ===== When JS adds .run: play everything exactly once ===== */
.stage.run {
  animation: bgCycle var(--full) linear 1 both;
}
.stage.run::before{
  animation: greenPhase var(--full) linear 1 both;
  opacity: 1;
}
.stage.run::after{
  animation: magentaPhase var(--full) linear 1 both;
  opacity: 1;
}
.stage.run .handoff{
  animation: handoffPhase var(--full) linear 1 both; /* second green dot near handover */
}

/* ===== Text layer: perfectly centered & color-inverted ===== */
.text {
  position: fixed;
  inset: 0;
  z-index: 10;                 /* text on top */
  display: flex;
  align-items: center;         /* vertical center */
  justify-content: center;     /* horizontal center */
  padding: 6vh 5vw;
  text-align: center;
  color: #fff;
  mix-blend-mode: difference;  /* invert vs background */
}

/* Container for fragments */
.fragments {
  position: relative;
  list-style: none;
  margin: 0;
  padding: 0;
  width: 100%;
}

/* Each fragment absolutely centered */
.fragments li{
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) translate3d(0, 6px, 0);

  /* Shorter fade-in, softened with blur */
  opacity: 0;
  filter: blur(var(--text-blur));
  transition:
    opacity .55s ease-out,
    filter  .55s ease-out,
    transform .55s ease-out;

  white-space: pre-wrap;
  font-size: clamp(24px, 5vw, 64px);
  font-weight: 600;
  letter-spacing: 0.02em;
  line-height: 1.15;
  will-change: opacity, filter, transform;
}
.fragments li.show{
  opacity: 1;
  filter: blur(0);
  transform: translate(-50%, -50%) translate3d(0, 0, 0);
}
/* Slower fade-out when hiding */
.fragments li.hiding{
  transition-duration: 1.1s;
  transition-timing-function: ease-in;
}

/* ===== Keyframes ===== */

/* Background color handover */
@keyframes bgCycle{
  0%     { background: var(--magenta); }
  47.73% { background: var(--magenta); }
  50%    { background: var(--green); }
  97.73% { background: var(--green); }
  100%   { background: var(--magenta); }
}

/* Percent helpers relative to full cycle (88s):
   3s  ≈ 3.41%    9s ≈ 10.23%
   Hold end (30s) = 34.09%
   Grow end (42s) = 47.73%
*/

/* GREEN dot — fade-in 3s, hold, grow, fade-out 9s ending at 50% */
@keyframes greenPhase{
  0%        { background-size: 10vmin 10vmin; opacity: 0; }        /* start invisible */
  3.41%     { background-size: 10vmin 10vmin; opacity: 1; }        /* fade-in done (~3s) */
  34.09%    { background-size: 10vmin 10vmin; opacity: 1; }        /* hold (~30s) */
  47.73%    { background-size: 220vmax 220vmax; opacity: 1; }      /* grow (~12s) */
  39.77%    { opacity: 1; }                                        /* start 9s fade-out */
  50%       { background-size: 220vmax 220vmax; opacity: 0; }      /* fade-out ends */
  100%      { background-size: 220vmax 220vmax; opacity: 0; }
}

/* Handoff second green dot — appears just before 50% and expands */
@keyframes handoffPhase{
  0%        { background-size: 0 0;     opacity: 0; }
  44%       { background-size: 0 0;     opacity: 0; }     /* idle */
  45%       { background-size: 6vmin 6vmin; opacity: 1; } /* pop in near center */
  50%       { background-size: 220vmax 220vmax; opacity: 1; } /* fills as we switch to green */
  51%       { opacity: 0; }                                   /* hide after handover */
  100%      { opacity: 0; }
}

/* MAGENTA dot — mirror in second half (3s in, 9s out to 100%) */
@keyframes magentaPhase{
  0%        { background-size: 220vmax 220vmax; opacity: 0; }      /* off in first half */
  50%       { background-size: 10vmin 10vmin;  opacity: 0; }       /* appears at midpoint */
  53.41%    { background-size: 10vmin 10vmin;  opacity: 1; }       /* fade-in done (~3s) */
  84.09%    { background-size: 10vmin 10vmin;  opacity: 1; }       /* hold (~30s) */
  97.73%    { background-size: 220vmax 220vmax; opacity: 1; }      /* grow (~12s) */
  89.77%    { opacity: 1; }                                        /* start 9s fade-out */
  100%      { background-size: 220vmax 220vmax; opacity: 0; }      /* fade-out ends */
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .stage, .stage::before, .stage::after, .handoff { animation: none !important; }
  .text .fragments li { transition: none; filter: none; transform: translate(-50%, -50%); }
}

/* Optional hint pill */
.hint {
  position: fixed; left: 12px; bottom: 12px;
  font-size: 12px; line-height: 1; padding: 8px 10px;
  background: rgba(255,255,255,0.16);
  color: #fff; border-radius: 999px;
  mix-blend-mode: difference;
  user-select: none;
}
